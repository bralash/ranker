<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: script.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: script.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// Trainee Dashboard Documentation

/**
 * Global Variables
 * ----------------
 * students: Array of student objects
 * weeks: Array of week objects, each containing student performance data
 * currentWeek: Number representing the current week being displayed
 */


let students = [];
let weeks = [];
let currentWeek = 0;

/**
 * Event Listeners
 * ---------------
 * These event listeners are set up when the DOM content is loaded.
 * They handle various user interactions with the dashboard.
 */
document.addEventListener("DOMContentLoaded", () => {
  document
    .getElementById("uploadButton")
    .addEventListener("click", handleFileUpload);
  document.getElementById("rankStudentsBtn").addEventListener("click", () => {
    rankStudents();
    updateDashboard();
  });
  document
    .getElementById("weekNumber")
    .addEventListener("change", handleWeekChange);

  document
    .querySelector(".close")
    .addEventListener("click", closeStudentDetailsModal);

  window.addEventListener("click",  event => {
    if (event.target == document.getElementById("studentDetailsModal")) {
      closeStudentDetailsModal();
    }
  });
  updateDashboard();
});


/**
 * File Upload Handling
 * --------------------
 */

/**
 * handleFileUpload()
 * Triggers when a file is selected for upload.
 * It reads the selected CSV file and passes its content to processCSV().
 */

const handleFileUpload = () => {
  const fileInput = document.getElementById("csvFileInput");
  const file = fileInput.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = e => {
      const csv = e.target.result;
      processCSV(csv);
    };
    reader.readAsText(file);
  } else {
    alert("Please select a CSV file to upload.");
  }
};


/**
 * processCSV(csv)
 * @param {string} csv - The content of the uploaded CSV file
 * Parses the CSV content and populates the students and weeks arrays.
 * It also updates the UI after processing the data.
 */
const processCSV = (csv) => {
  const lines = csv.split("\n");
  const headers = lines[0].split(",");

  students = [];
  weeks = [];

  for (let i = 1; i &lt; lines.length; i++) {
    const currentLine = lines[i].split(",");
    if (currentLine.length === headers.length) {
      const [studentName, weekNumber, quizScore, labScore] = currentLine;

      if (!students.some((s) => s.name === studentName)) {
        students.push({ name: studentName });
      }

      while (weeks.length &lt;= parseInt(weekNumber)) {
        weeks.push({ students: [] });
      }

      const weekIndex = parseInt(weekNumber);
      const studentIndex = weeks[weekIndex].students.findIndex(
        (s) => s.name === studentName
      );
      const studentData = {
        name: studentName,
        quiz: parseInt(quizScore),
        lab: parseInt(labScore),
      };

      if (studentIndex === -1) {
        weeks[weekIndex].students.push(studentData);
      } else {
        weeks[weekIndex].students[studentIndex] = studentData;
      }
    }
  }

  currentWeek = weeks.length - 1;
  updateUI();
};


/**
 * UI Updates
 * ----------
 */

/**
 * updateUI()
 * Calls various functions to update different parts of the UI.
 */
const updateUI = () => {
  updateWeekSelector();
  displayStudents();
  loadWeekData();
  updateCharts();
  rankStudents();
}


/**
 * updateWeekSelector()
 * Updates the week selector dropdown with available weeks.
 */
const updateWeekSelector = () => {
  const weekSelector = document.getElementById("weekNumber");
  weekSelector.innerHTML = "";
  for (let i = 0; i &lt; weeks.length; i++) {
    const option = document.createElement("option");
    option.value = i;
    option.textContent = `Week ${i}`;
    weekSelector.appendChild(option);
  }
  weekSelector.value = currentWeek;
};


/**
 * displayStudents()
 * Displays the list of students with input fields for quiz and lab scores.
 */
const displayStudents = () => {
  const traineeListContent = document.getElementById("traineeListContent");
  traineeListContent.innerHTML = "";

  students.forEach((student) => {
    const traineeItem = document.createElement("div");
    traineeItem.className = "trainee-item";

    const avatar = createAvatar(student.name);

    traineeItem.innerHTML = `
          &lt;div class="trainee-name">
              &lt;div class="trainee-avatar" style="background-color: ${avatar.color}">${avatar.initials}&lt;/div>
              ${student.name}
          &lt;/div>
          &lt;input type="number" id="${student.name}-quiz" class="trainee-input quiz" min="0" max="100" value="0">
          &lt;input type="number" id="${student.name}-lab" class="trainee-input lab" min="0" max="100" value="0">
          &lt;button class="view-details-btn" data-student="${student.name}">View Details&lt;/button>
      `;

    traineeListContent.appendChild(traineeItem);
  });

  // Add event listeners for the "View Details" buttons
  document.querySelectorAll(".view-details-btn").forEach((button) => {
    button.addEventListener("click", () => {
      const studentName = this.dataset.student;
      createStudentDetailsPage(studentName);
    });
  });
}


/**
 * loadWeekData()
 * Loads and displays the data for the current week.
 */
const loadWeekData = () => {
  const weekData = weeks[currentWeek];
  if (weekData) {
    students.forEach((student) => {
      const weekStudent = weekData.students.find(
        (s) => s.name === student.name
      );
      document.getElementById(`${student.name}-quiz`).value = weekStudent
        ? weekStudent.quiz
        : 0;
      document.getElementById(`${student.name}-lab`).value = weekStudent
        ? weekStudent.lab
        : 0;
    });
  } else {
    students.forEach((student) => {
      document.getElementById(`${student.name}-quiz`).value = 0;
      document.getElementById(`${student.name}-lab`).value = 0;
    });
  }
};



/**
 * Ranking
 * -------
 */

/**
 * rankStudents()
 * Calculates and displays the ranking of students based on their total scores.
 */
const rankStudents = () => {
  const rankedStudents = students.map((student) => ({
    name: student.name,
    quiz: parseInt(document.getElementById(`${student.name}-quiz`).value) || 0,
    lab: parseInt(document.getElementById(`${student.name}-lab`).value) || 0,
    total: 0,
  }));

  rankedStudents.forEach((student) => {
    student.total = student.quiz + student.lab;
  });

  rankedStudents.sort((a, b) => b.total - a.total);

  const rankedList = document.getElementById("rankedStudents");
  rankedList.innerHTML = "&lt;h2>Ranked Students&lt;/h2>";

  rankedStudents.forEach((student, index) => {
    const priority =
      student.total >= 160 ? "high" : student.total >= 120 ? "medium" : "low";
    const priorityText = priority.charAt(0).toUpperCase() + priority.slice(1);

    rankedList.innerHTML += `
          &lt;div class="student-row">
              &lt;div class="rank">${index + 1}&lt;/div>
              &lt;div class="avatar" style="background-color: ${getRandomColor()}">${getInitials(student.name)}&lt;/div>
              &lt;div class="student-name">${student.name}&lt;/div>
              &lt;div class="score">
                  &lt;span class="score-label">Quiz&lt;/span>
                  &lt;span class="score-value">${student.quiz}&lt;/span>
              &lt;/div>
              &lt;div class="score">
                  &lt;span class="score-label">Lab&lt;/span>
                  &lt;span class="score-value">${student.lab}&lt;/span>
              &lt;/div>
              &lt;div class="total-score">${student.total}&lt;/div>
              &lt;div class="priority">
                  &lt;span class="priority-indicator priority-${priority}">${priorityText}&lt;/span>
              &lt;/div>
          &lt;/div>
      `;
  });

  weeks[currentWeek] = { students: rankedStudents };
  updateCharts();
}



/**
 * Chart Updates
 * -------------
 */

/**
 * updateCharts()
 * Updates all charts in the dashboard.
 */
const updateCharts = () => {
  updateWeeklyChart();
  updateStudentTrendCharts();
  setupExportButtons();
}


/**
 * updateWeeklyChart()
 * Creates and updates the bar chart showing weekly performance for all students.
 */
const updateWeeklyChart = () => {
  const chartContainer = document.getElementById("weeklyChart");
  chartContainer.innerHTML =
    '&lt;canvas>&lt;/canvas>&lt;button class="export-btn" data-chart="weekly" title="Export Weekly Chart">&lt;i class="fas fa-file-export">&lt;/i>&lt;/button>';
  const canvas = chartContainer.querySelector("canvas");
  const ctx = canvas.getContext("2d");

  new Chart(ctx, {
    type: "bar",
    data: {
      labels: students.map((student) => student.name),
      datasets: [
        {
          label: "Quiz",
          data: students.map(
            (student) =>
              parseInt(document.getElementById(`${student.name}-quiz`).value) ||
              0
          ),
          backgroundColor: "rgba(75, 192, 192, 0.6)",
        },
        {
          label: "Lab",
          data: students.map(
            (student) =>
              parseInt(document.getElementById(`${student.name}-lab`).value) ||
              0
          ),
          backgroundColor: "rgba(255, 99, 132, 0.6)",
        },
      ],
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        title: {
          display: true,
          text: `Week ${currentWeek} Performance`,
        },
      },
    },
  });
};



/**
 * updateStudentTrendCharts()
 * Creates and updates line charts showing performance trends for each student.
 */
const updateStudentTrendCharts = () => {
  const chartsContainer = document.getElementById("studentTrendCharts");
  chartsContainer.innerHTML = "";

  students.forEach((student, index) => {
    const chartDiv = document.createElement("div");
    chartDiv.className = "chart-container";
    chartsContainer.appendChild(chartDiv);

    const canvas = document.createElement("canvas");
    chartDiv.appendChild(canvas);

    const exportBtn = document.createElement("button");
    exportBtn.className = "export-btn";
    exportBtn.title = `Export ${student.name} Chart`;
    exportBtn.innerHTML = `&lt;i class="fas fa-file-export">&lt;/i>`;
    exportBtn.dataset.chart = `student-${index}`;
    chartDiv.appendChild(exportBtn);

    const ctx = canvas.getContext("2d");

    const studentData = weeks.map((week) => {
      const studentWeekData = week.students.find(
        (s) => s.name === student.name
      );
      return {
        quiz: studentWeekData ? studentWeekData.quiz : 0,
        lab: studentWeekData ? studentWeekData.lab : 0,
      };
    });

    new Chart(ctx, {
      type: "line",
      data: {
        labels: weeks.map((_, index) => `Week ${index}`),
        datasets: [
          {
            label: "Quiz",
            data: studentData.map((data) => data.quiz),
            borderColor: "rgb(75, 192, 192)",
            tension: 0.1,
          },
          {
            label: "Lab",
            data: studentData.map((data) => data.lab),
            borderColor: "rgb(255, 99, 132)",
            tension: 0.1,
          },
        ],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          title: {
            display: true,
            text: `${student.name}'s Performance Trend`,
          },
        },
        scales: {
          y: {
            beginAtZero: true,
            max: 100,
          },
        },
      },
    });
  });
};



/**
 * Chart Export
 * ------------
 */

/**
 * setupExportButtons()
 * Sets up event listeners for chart export buttons.
 */
const setupExportButtons = () => {
  document.querySelectorAll(".export-btn").forEach((button) => {
    button.addEventListener("click", () => {
      const chartId = this.dataset.chart;
      let canvas;
      if (chartId === "weekly") {
        canvas = document.querySelector("#weeklyChart canvas");
      } else {
        const studentIndex = chartId.split("-")[1];
        canvas = document.querySelectorAll("#studentTrendCharts canvas")[
          studentIndex
        ];
      }

      const image = canvas.toDataURL("image/png");

      const tmpLink = document.createElement("a");
      tmpLink.download = `${chartId}-chart.png`;
      tmpLink.href = image;
      document.body.appendChild(tmpLink);
      tmpLink.click();
      document.body.removeChild(tmpLink);
    });
  });
};



/**
 * Week Management
 * ---------------
 */

/**
 * handleWeekChange(e)
 * @param {Event} e - The week change event
 * Handles the change of selected week and updates the UI accordingly.
 */
const handleWeekChange = (e) => {
  currentWeek = parseInt(e.target.value);
  loadWeekData();
  updateCharts();
};


/**
 * addWeek()
 * Adds a new week to the weeks array and updates the UI.
 */
const addWeek = () => {
  weeks.push({
    students: students.map((student) => ({
      name: student.name,
      quiz: 0,
      lab: 0,
    })),
  });
  currentWeek = weeks.length - 1;
  updateWeekSelector();
  loadWeekData();
  updateCharts();
};


/**
 * Student Details
 * ---------------
 */

/**
 * createStudentDetailsPage(studentName)
 * @param {string} studentName - The name of the student
 * Creates and displays a detailed page for a specific student.
 */
const createStudentDetailsPage = studentName =>{
  const student = students.find((s) => s.name === studentName);
  if (!student) return;

  const studentData = weeks.map((week) => {
    const studentWeekData = week.students.find((s) => s.name === studentName);
    return studentWeekData ? studentWeekData : { quiz: 0, lab: 0 };
  });

  const quizScores = studentData.map((data) => data.quiz);
  const labScores = studentData.map((data) => data.lab);

  const averageQuiz = quizScores.reduce((a, b) => a + b, 0) / quizScores.length;
  const averageLab = labScores.reduce((a, b) => a + b, 0) / labScores.length;
  const totalAverage = (averageQuiz + averageLab) / 2;
  
  const content = `
      &lt;div class="student-header">
          &lt;div class="trainee-avatar" style="background-color: ${createAvatar(student.name).color}">${createAvatar(student.name).initials}&lt;/div>
          &lt;h2>${student.name}'s Performance Details&lt;/h2>
      &lt;/div>
      &lt;div class="student-details">
          &lt;div class="stats-card">
              &lt;h3>Average Quiz Score&lt;/h3>
              &lt;div class="stats-value">${averageQuiz.toFixed(1)}%&lt;/div>
          &lt;/div>
          &lt;div class="stats-card">
              &lt;h3>Average Lab Score&lt;/h3>
              &lt;div class="stats-value">${averageLab.toFixed(1)}%&lt;/div>
          &lt;/div>
          &lt;div class="stats-card">
              &lt;h3>Total Average&lt;/h3>
              &lt;div class="stats-value">${totalAverage.toFixed(1)}%&lt;/div>
          &lt;/div>
          &lt;div class="stats-card">
              &lt;h3>Ranking&lt;/h3>
              &lt;div class="stats-value">#${getRanking(studentName)}&lt;/div>
          &lt;/div>
          &lt;div class="chart-detail-container">
              &lt;canvas id="studentDetailChart">&lt;/canvas>
          &lt;/div>
          &lt;div class="weekly-scores">
              &lt;h3>Weekly Scores&lt;/h3>
              &lt;table>
                  &lt;thead>
                      &lt;tr>
                          &lt;th>Week&lt;/th>
                          &lt;th>Average Quiz Score&lt;/th>
                          &lt;th>Average Lab Score&lt;/th>
                          &lt;th>Total&lt;/th>
                      &lt;/tr>
                  &lt;/thead>
                  &lt;tbody>
                      ${studentData
                        .map(
                          (data, index) => `
                          &lt;tr>
                              &lt;td>Week ${index}&lt;/td>
                              &lt;td>${data.quiz}&lt;/td>
                              &lt;td>${data.lab}&lt;/td>
                              &lt;td>${data.quiz + data.lab}&lt;/td>
                          &lt;/tr>
                      `
                        )
                        .join("")}
                  &lt;/tbody>
              &lt;/table>
          &lt;/div>
      &lt;/div>
      &lt;button class="export-image" onclick="exportToImage('${studentName}')">Export as Image&lt;/button>
  `;

  document.getElementById("studentDetailsContent").innerHTML = content;

  const ctx = document.getElementById("studentDetailChart").getContext("2d");
  new Chart(ctx, {
    type: "line",
    data: {
      labels: weeks.map((_, index) => `Week ${index}`),
      datasets: [
        {
          label: "Quiz",
          data: quizScores,
          borderColor: "rgb(75, 192, 192)",
          tension: 0.1,
        },
        {
          label: "Lab",
          data: labScores,
          borderColor: "rgb(255, 99, 132)",
          tension: 0.1,
        },
      ],
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: `${student.name}'s Performance Trend`,
        },
      },
      scales: {
        y: {
          beginAtZero: true,
          max: 100,
        },
      },
    },
  });

  document.getElementById("studentDetailsModal").style.display = "block";
}


/**
 * closeStudentDetailsModal()
 * Closes the student details modal.
 */
const closeStudentDetailsModal = () => {
  document.getElementById("studentDetailsModal").style.display = "none";
};


/**
 * Utility Functions
 * -----------------
 */

/**
 * getInitials(name)
 * @param {string} name - The full name of a student
 * @returns {string} The initials of the student
 */
const getInitials = name =>{
  return name
    .split(" ")
    .map((word) => word[0].toUpperCase())
    .join("");
}


/**
 * getRandomColor()
 * @returns {string} A random color in hexadecimal format
 */
const getRandomColor = () => {
  const letters = "0123456789ABCDEF";
  let color = "#";
  for (let i = 0; i &lt; 6; i++) {
    color += letters[Math.floor(Math.random() * 16)];
  }
  return color;
}


/**
 * createAvatar(name)
 * @param {string} name - The name of the student
 * @returns {Object} An object containing initials and color for the avatar
 */
const createAvatar = name => {
  const initials = name
    .split(" ")
    .map((word) => word[0].toUpperCase())
    .join("");
  const color = getRandomColor();
  return { initials, color };
}


/**
 * getRanking(studentName)
 * @param {string} studentName - The name of the student
 * @returns {number} The ranking of the student
 */
const getRanking = studentName => {
  const rankedStudents = [...students].sort((a, b) => {
    const aTotal = weeks.reduce((sum, week) => {
      const student = week.students.find((s) => s.name === a.name);
      return sum + (student ? student.quiz + student.lab : 0);
    }, 0);
    const bTotal = weeks.reduce((sum, week) => {
      const student = week.students.find((s) => s.name === b.name);
      return sum + (student ? student.quiz + student.lab : 0);
    }, 0);
    return bTotal - aTotal;
  });
  return (
    rankedStudents.findIndex((student) => student.name === studentName) + 1
  );
}


/**
 * exportToImage(studentName)
 * @param {string} studentName - The name of the student
 * Exports the student details page as an image.
 */
const exportToImage = studentName =>{
  const element = document.getElementById("studentDetailsContent");
  const exportButton = document.querySelector(".export-image");

  // Show loading state
  exportButton.textContent = "Generating Image...";
  exportButton.disabled = true;

  element.classList.add("capturing");

  html2canvas(element, {
    scale: 2,
    logging: false,
    useCORS: true,
    backgroundColor: "#ffffff",
  })
    .then((canvas) => {
      element.classList.remove("capturing");

      const image = canvas
        .toDataURL("image/png")
        .replace("image/png", "image/octet-stream");
      const link = document.createElement("a");
      link.download = `${studentName}_performance.png`;
      link.href = image;
      link.click();

      // Reset button state
      exportButton.textContent = "Export as Image";
      exportButton.disabled = false;
    })
    .catch((error) => {
      console.error("Error generating image:", error);
      alert("There was an error generating the image. Please try again.");

      // Reset button state
      exportButton.textContent = "Export as Image";
      exportButton.disabled = false;
    });
}


/**
 * Performance Analysis
 * --------------------
 */

/**
 * analyzeStudentPerformance()
 * @returns {Array} An array of students needing support
 * Analyzes student performance to identify those who need additional support.
 */
const analyzeStudentPerformance = () => {
  const supportNeeded = [];
  const threshold = 60; // Passing score threshold
  const consistentLowPerformance = 3; // Number of consecutive low scores to flag

  students.forEach((student) => {
    const performances = weeks
      .map((week) => {
        const studentData = week.students.find((s) => s.name === student.name);
        return studentData ? (studentData.quiz + studentData.lab) / 2 : null;
      })
      .filter((score) => score !== null);

    if (performances.length > 0) {
      const recentPerformances = performances.slice(-consistentLowPerformance);
      const averageScore =
        recentPerformances.reduce((sum, score) => sum + score, 0) /
        recentPerformances.length;
      const isDecreasing =
        performances.length >= consistentLowPerformance &amp;&amp;
        performances
          .slice(-consistentLowPerformance)
          .every(
            (score, index, array) => index === 0 || score &lt;= array[index - 1]
          );

      if (averageScore &lt; threshold || isDecreasing) {
        supportNeeded.push({
          name: student.name,
          averageScore: averageScore.toFixed(2),
          trend: isDecreasing ? "Decreasing" : "Low",
          lastScore: performances[performances.length - 1].toFixed(2),
        });
      }
    }
  });
  return supportNeeded;
}


/**
 * updateSupportNeededList()
 * Updates the list of students needing additional support.
 */
const updateSupportNeededList = () => {
  const supportNeeded = analyzeStudentPerformance();
  const supportNeededList = document.getElementById("supportNeededList");
  supportNeededList.innerHTML = "";

  if (supportNeeded.length === 0) {
    supportNeededList.innerHTML =
      "&lt;p>No trainees currently need additional support.&lt;/p>";
    return;
  }

  supportNeeded.forEach((student) => {
    const studentItem = document.createElement("div");
    studentItem.className = "support-needed-item";
    studentItem.innerHTML = `
          &lt;span class="support-needed-name">${student.name}&lt;/span>
          &lt;span class="support-needed-score">Average: ${student.averageScore}&lt;/span>
          &lt;span class="support-needed-score">Last Score: ${student.lastScore}&lt;/span>
          &lt;span class="support-needed-trend trend-${student.trend.toLowerCase()}">${student.trend}&lt;/span>
      `;
    supportNeededList.appendChild(studentItem);
  });
}



/**
 * updateDashboard()
 * Updates the entire dashboard, including charts and support needed list.
 */
const updateDashboard = () => {
  updateCharts();
  updateSupportNeededList();
}


</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addWeek">addWeek</a></li><li><a href="global.html#analyzeStudentPerformance">analyzeStudentPerformance</a></li><li><a href="global.html#closeStudentDetailsModal">closeStudentDetailsModal</a></li><li><a href="global.html#createAvatar">createAvatar</a></li><li><a href="global.html#createStudentDetailsPage">createStudentDetailsPage</a></li><li><a href="global.html#displayStudents">displayStudents</a></li><li><a href="global.html#exportToImage">exportToImage</a></li><li><a href="global.html#getInitials">getInitials</a></li><li><a href="global.html#getRandomColor">getRandomColor</a></li><li><a href="global.html#getRanking">getRanking</a></li><li><a href="global.html#handleFileUpload">handleFileUpload</a></li><li><a href="global.html#handleWeekChange">handleWeekChange</a></li><li><a href="global.html#loadWeekData">loadWeekData</a></li><li><a href="global.html#processCSV">processCSV</a></li><li><a href="global.html#rankStudents">rankStudents</a></li><li><a href="global.html#setupExportButtons">setupExportButtons</a></li><li><a href="global.html#students">students</a></li><li><a href="global.html#updateCharts">updateCharts</a></li><li><a href="global.html#updateDashboard">updateDashboard</a></li><li><a href="global.html#updateStudentTrendCharts">updateStudentTrendCharts</a></li><li><a href="global.html#updateSupportNeededList">updateSupportNeededList</a></li><li><a href="global.html#updateUI">updateUI</a></li><li><a href="global.html#updateWeekSelector">updateWeekSelector</a></li><li><a href="global.html#updateWeeklyChart">updateWeeklyChart</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.3</a> on Wed Aug 14 2024 17:22:45 GMT+0000 (Greenwich Mean Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
